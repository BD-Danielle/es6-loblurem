(()=>{class t{static DEFAULT_THROTTLE_DELAY=250;static DEFAULT_BLUR=4;static DEFAULT_OFFSET_X=2.5;charsPerSentence=[7,8,9,10,11,12,13];wordsSample=["心","戶","手","文","斗","斤","方","日","月","木","令","北","本","以","主","充","半","失","巧","平","在","回","休","交","至","再","光","先","全","共","邱","附","怖","長","使","其","非","並","刻","取","既","洋","拜","面","促","前","飛","亮","信","香","班","借","家","勉","冠","英","苦","為","段","派","荷","推","區","停","假","動","健","夠","問","將","傻","勢","亂","傷","圓","傲","照","滄","溺","準","境","厭","像","夢","奪","摘","實","寧","管","種","褪","選","隨","憑","導","憾","奮","擋","曉","暸","懷","穩","曠","邊","難","願","關","壞","爆","攏"];marks=["，","？","！","、","。"];comma="。";id=Math.random().toString(16).slice(2);constructor(e){this.selector=e,this.resizeHandler=this.throttle(this.rendering.bind(this),t.DEFAULT_THROTTLE_DELAY),this.init()}get buttons(){return this.selector.querySelectorAll("[data-loblurem-btn]")}get getDisplay(){return this.selector.getAttribute("data-loblurem-display")}get options(){const e=this.selector.getAttribute("data-loblurem").split("/"),s=(t,e)=>Number.isInteger(parseInt(t))?parseInt(t):e;return{counts:s(e[0],e[0].length),contents:Number.isInteger(parseInt(e[0]))?[]:e[0].split(""),fontSize:s(e[1],0),lineHeight:s(e[2],0),color:e[3],letterSpacing:s(e[4],0),blur:s(e[5],t.DEFAULT_BLUR)}}get svgWidth(){return this.selector.offsetWidth||this.selector.parentElement.offsetWidth}get charsPerRow(){return Math.floor(this.svgWidth/(this.options.fontSize+this.options.letterSpacing))-1}get lineHeight(){return this.options.fontSize+this.options.lineHeight}shuffleArray(t){return t.sort((()=>Math.random()-.5))}generateCounts(t){const e=[...this.charsPerSentence];let s=[];for(;t>0;)e.reduce(((e,i,n,o)=>(e<=0&&o.splice(0),s.push(i),t=e-i)),t);for(s.sort(((t,e)=>e-t));t<0;)for(let e=0;e<s.length&&(s[e]-=1,!((t+=1)>=0));e++);return s}sortText(){let t=this.shuffleArray(this.generateCounts(this.options.counts)),e=this.shuffleArray(this.marks),s=[...this.options.contents];return t=s.length?t.map((t=>s.splice(0,t))):t.map((t=>this.shuffleArray(this.wordsSample).slice(0,t))),this.options.contents.length||t.map(((t,s,i)=>{t.splice(-1,1,e[Math.floor(Math.random()*e.length)]),s===i.length-1&&t.splice(-1,1,this.comma)})),t=t.flat(),this.selector.setAttribute("data-loblurem",`${t.join("")}/${this.options.fontSize}/${this.options.lineHeight}/${this.options.color}/${this.options.letterSpacing}/${this.options.blur}`),t=t.map(((t,e,s)=>s.slice(e*this.charsPerRow,e*this.charsPerRow+this.charsPerRow))).filter((t=>t.length)),t}generateSVGContent(){let t="",e=this.getOffsetX(),s=this.sortText(),i=this.lineHeight*s.length;return s.forEach(((s,i,n)=>{i===n.length-1?t+=`\n        <text kerning="auto" font-family="Microsoft JhengHei" filter="url(#drop-shadow${this.id})" font-size="${this.options.fontSize}px" x="${e}px" y="${this.lineHeight*(i+1)-2}px" letter-spacing="${this.options.letterSpacing}px" font-size="${this.options.fontSize}px" fill="${this.options.color}">${s.join("")}</text>\n        `:t+=`\n        <text kerning="auto" font-family="Microsoft JhengHei" filter="url(#drop-shadow${this.id})" font-size="${this.options.fontSize}px" x="${e}px" y="${this.lineHeight*(i+1)-2}px" letter-spacing="${this.options.letterSpacing}px" textLength="${this.svgWidth}" font-size="${this.options.fontSize}px" fill="${this.options.color}">${s.join("")}</text>\n        `})),`\n    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${this.svgWidth}px" height="${i+7}px" display="block">\n      <filter id="drop-shadow${this.id}"><feGaussianBlur stdDeviation="${this.options.blur}"></feGaussianBlur></filter>\n        ${t}\n    </svg>\n    `}getOffsetX(){let e;switch(this.getDisplay){case"middle":e=this.calculateMiddleOffsetX();break;case"right":e=this.calculateRightOffsetX();break;default:e=t.DEFAULT_OFFSET_X}return e}calculateMiddleOffsetX(){return this.svgWidth/2-(this.options.fontSize*this.options.counts+this.options.letterSpacing*(this.options.counts-1))/2}calculateRightOffsetX(){return this.svgWidth-(this.options.fontSize*this.options.counts+this.options.letterSpacing*(this.options.counts-1))-3}centreBtn(){if(!this.buttons.length)return;this.selector.style.position="relative";let t=this.lineHeight*this.sortText().length,e=this.selector.offsetHeight-t,s=[...this.buttons].map((t=>t.offsetHeight)).reduce(((t,e)=>{t.length||t.push(e);let s=t[t.length-1];return t.push(s+e),t}),[0]);this.buttons.forEach(((i,n)=>{Object.assign(i.style,{top:e+(t-this.buttons[0].offsetHeight)/2+s[n]+"px",position:"absolute",left:"50%",transform:"translate(-50%, 0)",zIndex:1,margin:0})}))}throttle(e,s=t.DEFAULT_THROTTLE_DELAY){let i=0;return()=>{const t=Date.now();t-i>=s&&(e.call(this),i=t)}}init(){this.selector.style.userSelect=this.selector.style.MozUserSelect=this.selector.style.WebkitUserSelect=this.selector.style.MsUserSelect="none",this.rendering(),this.resize()}rendering(){this.selector.innerHTML+=this.generateSVGContent(),this.centreBtn()}resize(){const t=()=>{this.selector.lastElementChild&&(this.selector.lastElementChild.remove(),this.selector.innerHTML+=this.generateSVGContent(),this.centreBtn())};window.addEventListener("resize",this.throttle(t)),window.addEventListener("scroll",this.throttle(t))}}window.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("[data-loblurem]").forEach((e=>new t(e)))})),window.Loblurem=t})();